'''cveget使用的是爬取cve搜索页面的结果，比如某个漏洞，如果你搜索ngxin可以搜索出来，搜索apache也可以搜索出来，且都在前十个，那么就可能会重复，数据可能对不上。'''

from cveget import cveget
from database import create_database, insert_cve_info
from cveput import cve_details_get
import logging
from datetime import datetime

new_cveid_list = []
create_database()
logging.basicConfig(filename='cve.log',
                    filemode='a',
                    format='%(asctime)s - %(message)s',
                    level=logging.INFO)
today = datetime.today().strftime('%Y-%m-%d')

cveid_list = cveget()
logging.info(f'[{today}] cveid_list: {cveid_list}')

if cveid_list:
    new_cveid_list = insert_cve_info(cveid_list)
    logging.info(f'[{today}] new_cveid_list: {cveid_list}')
    print(new_cveid_list)

    if new_cveid_list:
        cve_details_get(new_cveid_list)
    else:
        print('无新漏洞')
else:
    print('cveid_list为空，检查cveget.py')
