# cveget的单线程实现

import requests
from bs4 import BeautifulSoup


def cveget():
    components = [
        'nginx', 'apache', 'tomcat', 'ss', 'lighttpd', 'openssh', 'MongoDB',
        'jdk'
    ]  # 后续改成配置文件，方便更改
    header = {
        "User-Agent":
        "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.36"
    }
    url = 'https://cve.mitre.org/cgi-bin/cvekey.cgi?keyword='

    #  查重爬取     爬取指定组件内容并解析,存cveid
    cveid_list = []
    for component in components:
        component_cveid_list = []
        urlnow = url + component
        response = requests.get(urlnow, headers=header)
        html = response.text
        soup = BeautifulSoup(html, 'html.parser')
        component_cveid_list = [
            cve.text for cve in soup.select(
                'a[href*="/cgi-bin/cvename.cgi?name="]')[:10]
        ]
        if cveid_list is not None:
            print('组件<' + component + '>前十个漏洞爬取情况')
            print(component_cveid_list)
            print(
                '############################################################')
        else:
            print("查重爬取失败，没有数据")
        cveid_list.extend(component_cveid_list)
    # print(cveid_list)
    return cveid_list


cveget()