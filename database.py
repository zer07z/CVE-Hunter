import sqlite3


def create_database():
    conn = sqlite3.connect('cve.db')
    c = conn.cursor()
    c.execute('''CREATE TABLE IF NOT EXISTS cve_info
                (cveid TEXT PRIMARY KEY,
                 description TEXT,
                 date TEXT,
                 link TEXT);''')
    conn.commit()
    conn.close()


def insert_cve_info(cveid_list):
    conn = sqlite3.connect('cve.db')
    c = conn.cursor()
    new_cveid_list = []
    for cveid in cveid_list:
        # new_cveid_list = []
        c.execute("SELECT * FROM cve_info WHERE cveid = ?", (cveid, ))
        if c.fetchone() is None:
            c.execute("INSERT INTO cve_info (cveid) VALUES (?)", (cveid, ))
            print(cveid)
            new_cveid_list.append(cveid)
    conn.commit()
    conn.close()
    print('经过查重，如下列表中的cveid未在数据库中，已写入数据库')
    return new_cveid_list
